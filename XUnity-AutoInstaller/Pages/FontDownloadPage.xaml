<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="XUnity_AutoInstaller.Pages.FontDownloadPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:XUnity_AutoInstaller.Pages"
    xmlns:models="using:XUnity_AutoInstaller.Models"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <ScrollViewer Margin="24">
        <StackPanel Spacing="24">
            <!-- 页面标题 -->
            <TextBlock
                Text="TextMeshPro字体资源下载"
                Style="{StaticResource TitleTextBlockStyle}"/>

            <!-- Unity 版本信息 -->
            <StackPanel Spacing="16">
                <TextBlock
                    Text="游戏信息"
                    Style="{StaticResource SubtitleTextBlockStyle}"/>

                <Border
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="20">
                    <StackPanel Spacing="8">
                        <TextBlock FontSize="14">
                            <Run FontWeight="SemiBold" Text="Unity 版本: "/>
                            <Run Text="{x:Bind ViewModel.UnityVersion, Mode=OneWay}"/>
                        </TextBlock>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- 字体列表区域 -->
            <StackPanel Spacing="16">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <TextBlock
                        Text="可用字体"
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        VerticalAlignment="Center"/>
                    <Button
                        Style="{StaticResource TextBlockButtonStyle}"
                        Command="{x:Bind ViewModel.LoadFontsCommand}"
                        VerticalAlignment="Center">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <FontIcon Glyph="&#xE72C;" FontSize="16"/>
                                <TextBlock Text="刷新" FontSize="14"/>
                            </StackPanel>
                        </Button.Content>
                    </Button>
                </StackPanel>

                <!-- 筛选控件 -->
                <StackPanel
                    Orientation="Horizontal"
                    Spacing="12">
                    <TextBox
                        x:Name="FontNameFilterBox"
                        Header="字体名称"
                        PlaceholderText="输入字体名称筛选..."
                        Width="250"
                        Text="{x:Bind ViewModel.FontNameFilter, Mode=TwoWay}"/>
                    <ComboBox
                        x:Name="UnityVersionFilterBox"
                        Header="Unity 版本"
                        Width="180"
                        SelectedIndex="{x:Bind ViewModel.SelectedUnityVersionFilterIndex, Mode=TwoWay}">
                        <ComboBoxItem Content="全部版本" Tag=""/>
                        <ComboBoxItem Content="Unity 6 (6000+)" Tag="6000"/>
                        <ComboBoxItem Content="2017" Tag="2017"/>
                        <ComboBoxItem Content="2018" Tag="2018"/>
                        <ComboBoxItem Content="2019" Tag="2019"/>
                        <ComboBoxItem Content="2020" Tag="2020"/>
                        <ComboBoxItem Content="2021" Tag="2021"/>
                        <ComboBoxItem Content="2022" Tag="2022"/>
                    </ComboBox>
                    <Button
                        Content="清除筛选"
                        Command="{x:Bind ViewModel.ClearFilterCommand}"
                        VerticalAlignment="Bottom"
                        Margin="0,0,0,2"/>
                </StackPanel>

                <Border
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8">
                    <Grid>
                        <StackPanel>
                            <!-- 表头 -->
                            <Border
                                Background="{ThemeResource LayerFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="0,0,0,1"
                                Padding="16,12">
                                <Grid ColumnSpacing="16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="2*"/>
                                        <ColumnDefinition Width="2*"/>
                                        <ColumnDefinition Width="1.5*"/>
                                        <ColumnDefinition Width="1.5*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 字体名称列头 -->
                                    <Button
                                        Grid.Column="0"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Padding="0"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Left"
                                        Command="{x:Bind ViewModel.SortByFontNameCommand}">
                                        <Button.Content>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <TextBlock Text="字体名称" FontWeight="SemiBold" FontSize="14"/>
                                                <FontIcon
                                                    Glyph="{x:Bind ViewModel.FontNameSortGlyph, Mode=OneWay}"
                                                    FontSize="12"
                                                    Visibility="{x:Bind ViewModel.FontNameSortIconVisibility, Mode=OneWay}"/>
                                            </StackPanel>
                                        </Button.Content>
                                    </Button>

                                    <!-- Unity 版本列头 -->
                                    <Button
                                        Grid.Column="1"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Padding="0"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Left"
                                        Command="{x:Bind ViewModel.SortByUnityVersionCommand}">
                                        <Button.Content>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <TextBlock Text="Unity 版本" FontWeight="SemiBold" FontSize="14"/>
                                                <FontIcon
                                                    Glyph="{x:Bind ViewModel.UnityVersionSortGlyph, Mode=OneWay}"
                                                    FontSize="12"
                                                    Visibility="{x:Bind ViewModel.UnityVersionSortIconVisibility, Mode=OneWay}"/>
                                            </StackPanel>
                                        </Button.Content>
                                    </Button>

                                    <!-- 文件大小列头 -->
                                    <Button
                                        Grid.Column="2"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Padding="0"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Left"
                                        Command="{x:Bind ViewModel.SortByFileSizeCommand}">
                                        <Button.Content>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <TextBlock Text="文件大小" FontWeight="SemiBold" FontSize="14"/>
                                                <FontIcon
                                                    Glyph="{x:Bind ViewModel.FileSizeSortGlyph, Mode=OneWay}"
                                                    FontSize="12"
                                                    Visibility="{x:Bind ViewModel.FileSizeSortIconVisibility, Mode=OneWay}"/>
                                            </StackPanel>
                                        </Button.Content>
                                    </Button>

                                    <!-- 状态列头 -->
                                    <TextBlock
                                        Grid.Column="3"
                                        Text="状态"
                                        FontWeight="SemiBold"
                                        FontSize="14"/>
                                </Grid>
                            </Border>

                            <!-- 字体列表 -->
                            <ScrollViewer Height="450" Visibility="{x:Bind ViewModel.ContentVisibility, Mode=OneWay}">
                                <ListView
                                    x:Name="FontListView"
                                    ItemsSource="{x:Bind ViewModel.Fonts, Mode=OneWay}"
                                    SelectionMode="None">
                                    <ListView.ItemTemplate>
                                        <DataTemplate x:DataType="models:FontResourceInfo">
                                            <Grid Padding="16,12" ColumnSpacing="16">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="2*"/>
                                                    <ColumnDefinition Width="2*"/>
                                                    <ColumnDefinition Width="1.5*"/>
                                                    <ColumnDefinition Width="1.5*"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- 字体名称 -->
                                                <TextBlock
                                                    Grid.Column="0"
                                                    Text="{x:Bind DisplayFontName}"
                                                    FontSize="14"
                                                    VerticalAlignment="Center"/>

                                                <!-- Unity 版本 + 推荐标识 -->
                                                <StackPanel
                                                    Grid.Column="1"
                                                    Orientation="Horizontal"
                                                    Spacing="8"
                                                    VerticalAlignment="Center">
                                                    <TextBlock
                                                        Text="{x:Bind UnityVersionForDisplay}"
                                                        FontSize="14"
                                                        VerticalAlignment="Center"/>
                                                    <Border
                                                        Background="{ThemeResource SystemFillColorSuccessBrush}"
                                                        CornerRadius="4"
                                                        Padding="8,2"
                                                        Visibility="{x:Bind RecommendedBadgeVisibility}">
                                                        <TextBlock
                                                            Text="推荐"
                                                            FontSize="12"
                                                            FontWeight="SemiBold"
                                                            Foreground="White"/>
                                                    </Border>
                                                </StackPanel>

                                                <!-- 文件大小 -->
                                                <TextBlock
                                                    Grid.Column="2"
                                                    Text="{x:Bind FileSizeFormatted}"
                                                    FontSize="14"
                                                    VerticalAlignment="Center"/>

                                                <!-- 状态/操作按钮 -->
                                                <StackPanel
                                                    Grid.Column="3"
                                                    Spacing="6"
                                                    Orientation="Horizontal"
                                                    VerticalAlignment="Center">

                                                    <!-- 下载按钮 -->
                                                    <Button
                                                        FontSize="13"
                                                        Height="32"
                                                        Padding="12,4"
                                                        Tag="{x:Bind}"
                                                        Visibility="{x:Bind IsDownloadButtonVisible}"
                                                        Click="DownloadButton_Click">
                                                        <Button.Content>
                                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                                <FontIcon Glyph="&#xE896;" FontSize="12"/>
                                                                <TextBlock Text="下载"/>
                                                            </StackPanel>
                                                        </Button.Content>
                                                    </Button>

                                                    <!-- 安装按钮 -->
                                                    <Button
                                                        FontSize="13"
                                                        Height="32"
                                                        Padding="12,4"
                                                        Style="{StaticResource AccentButtonStyle}"
                                                        Tag="{x:Bind}"
                                                        Visibility="{x:Bind IsInstallButtonVisible}"
                                                        Click="InstallButton_Click">
                                                        <Button.Content>
                                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                                <FontIcon Glyph="&#xE74C;" FontSize="12"/>
                                                                <TextBlock Text="安装"/>
                                                            </StackPanel>
                                                        </Button.Content>
                                                    </Button>

                                                    <!-- 已安装状态 -->
                                                    <StackPanel
                                                        Orientation="Horizontal"
                                                        Spacing="4"
                                                        Visibility="{x:Bind IsInstalledStatusVisible}">
                                                        <FontIcon
                                                            Glyph="&#xE73E;"
                                                            FontSize="14"
                                                            Foreground="{ThemeResource SystemFillColorSuccessBrush}"/>
                                                        <TextBlock
                                                            Text="已安装"
                                                            FontSize="13"
                                                            Foreground="{ThemeResource SystemFillColorSuccessBrush}"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                    <ListView.ItemContainerStyle>
                                        <Style TargetType="ListViewItem">
                                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                            <Setter Property="Padding" Value="0"/>
                                        </Style>
                                    </ListView.ItemContainerStyle>
                                </ListView>
                            </ScrollViewer>
                        </StackPanel>

                        <!-- 空状态提示 -->
                        <StackPanel
                            x:Name="EmptyFontsPanel"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="12"
                            Visibility="{x:Bind ViewModel.EmptyVisibility, Mode=OneWay}">
                            <FontIcon
                                Glyph="&#xE8D2;"
                                FontSize="48"
                                Opacity="0.3"/>
                            <TextBlock
                                Text="未找到匹配的字体"
                                FontSize="16"
                                Opacity="0.6"/>
                            <Button
                                Content="清除筛选"
                                Style="{StaticResource AccentButtonStyle}"
                                Command="{x:Bind ViewModel.ClearFilterCommand}"/>
                        </StackPanel>

                        <!-- 加载中提示 -->
                        <StackPanel
                            x:Name="LoadingPanel"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="12"
                            Visibility="{x:Bind ViewModel.LoadingVisibility, Mode=OneWay}">
                            <ProgressRing
                                IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                                Width="48"
                                Height="48"/>
                            <TextBlock
                                Text="加载字体列表中..."
                                FontSize="14"
                                Opacity="0.7"/>
                        </StackPanel>

                        <!-- 错误提示 -->
                        <StackPanel
                            x:Name="ErrorPanel"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="12"
                            Visibility="{x:Bind ViewModel.ErrorVisibility, Mode=OneWay}">
                            <FontIcon
                                Glyph="&#xE7BA;"
                                FontSize="48"
                                Opacity="0.3"
                                Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>
                            <TextBlock
                                x:Name="ErrorTextBlock"
                                Text="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                                FontSize="16"
                                Opacity="0.6"
                                TextAlignment="Center"
                                TextWrapping="Wrap"
                                MaxWidth="400"/>
                            <Button
                                Content="重试"
                                Style="{StaticResource AccentButtonStyle}"
                                Command="{x:Bind ViewModel.LoadFontsCommand}"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</Page>
