<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="XUnity_AutoInstaller.Pages.FontDownloadPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:XUnity_AutoInstaller.Pages"
    xmlns:models="using:XUnity_AutoInstaller.Models"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <ScrollViewer Margin="24">
        <StackPanel Spacing="24">
            <!-- 页面标题 -->
            <TextBlock
                Text="字体资源下载"
                FontSize="32"
                FontWeight="Bold"
                Margin="0,0,0,8"/>

            <!-- Unity 版本检测区域 -->
            <StackPanel Spacing="16">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon
                        Glyph="&#xE946;"
                        FontSize="24"
                        VerticalAlignment="Center"
                        Foreground="{ThemeResource SystemAccentColor}"/>
                    <TextBlock
                        Text="游戏信息"
                        FontSize="22"
                        FontWeight="SemiBold"
                        VerticalAlignment="Center"/>
                </StackPanel>

                <Border
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="20">
                    <StackPanel Spacing="12">
                        <!-- 游戏路径 -->
                        <StackPanel Spacing="4">
                            <TextBlock Text="游戏路径" FontWeight="SemiBold" FontSize="14"/>
                            <TextBlock
                                x:Name="GamePathTextBlock"
                                Text="未选择游戏"
                                FontSize="14"
                                Opacity="0.7"
                                TextWrapping="Wrap"/>
                        </StackPanel>

                        <!-- Unity 版本 -->
                        <StackPanel Spacing="4">
                            <TextBlock Text="Unity 版本" FontWeight="SemiBold" FontSize="14"/>
                            <TextBlock
                                x:Name="UnityVersionTextBlock"
                                Text="检测中..."
                                FontSize="14"
                                Opacity="0.7"/>
                        </StackPanel>

                        <!-- 提示信息 -->
                        <InfoBar
                            x:Name="VersionInfoBar"
                            IsOpen="True"
                            IsClosable="False"
                            Severity="Informational"
                            Message="推荐使用与游戏 Unity 版本最接近的字体资源，以确保最佳兼容性"/>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- 可用字体列表区域 -->
            <StackPanel Spacing="16">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon
                        Glyph="&#xE8D2;"
                        FontSize="24"
                        VerticalAlignment="Center"
                        Foreground="{ThemeResource SystemAccentColor}"/>
                    <TextBlock
                        Text="可用字体"
                        FontSize="22"
                        FontWeight="SemiBold"
                        VerticalAlignment="Center"/>
                    <Button
                        Style="{StaticResource TextBlockButtonStyle}"
                        Click="RefreshButton_Click">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <FontIcon Glyph="&#xE72C;" FontSize="16"/>
                                <TextBlock Text="刷新" FontSize="14"/>
                            </StackPanel>
                        </Button.Content>
                    </Button>
                </StackPanel>

                <Border
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Height="450">
                    <Grid>
                        <!-- 字体列表 -->
                        <ListView
                            x:Name="FontListView"
                            SelectionMode="None">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="models:FontResourceInfo">
                                    <Grid Padding="12,8" ColumnSpacing="16">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- 左侧信息 -->
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock
                                                Text="{x:Bind DisplayName}"
                                                FontWeight="SemiBold"
                                                FontSize="16"/>
                                            <TextBlock
                                                FontSize="14"
                                                Opacity="0.7">
                                                <Run Text="字体: "/>
                                                <Run Text="{x:Bind FontName}"/>
                                            </TextBlock>
                                            <TextBlock
                                                FontSize="14"
                                                Opacity="0.7">
                                                <Run Text="大小: "/>
                                                <Run Text="{x:Bind FileSizeFormatted}"/>
                                                <Run Text=" | 更新: "/>
                                                <Run Text="{x:Bind LastModified}"/>
                                            </TextBlock>
                                        </StackPanel>

                                        <!-- 右侧操作按钮 -->
                                        <StackPanel
                                            Grid.Column="1"
                                            Spacing="8"
                                            VerticalAlignment="Center">

                                            <!-- 下载按钮 -->
                                            <Button
                                                FontSize="14"
                                                Height="36"
                                                Padding="16,6"
                                                Tag="{x:Bind}"
                                                Visibility="{x:Bind IsDownloadButtonVisible}"
                                                Click="DownloadButton_Click">
                                                <Button.Content>
                                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                                        <FontIcon Glyph="&#xE896;" FontSize="14"/>
                                                        <TextBlock Text="下载"/>
                                                    </StackPanel>
                                                </Button.Content>
                                            </Button>

                                            <!-- 安装按钮 -->
                                            <Button
                                                FontSize="14"
                                                Height="36"
                                                Padding="16,6"
                                                Style="{StaticResource AccentButtonStyle}"
                                                Tag="{x:Bind}"
                                                Visibility="{x:Bind IsInstallButtonVisible}"
                                                Click="InstallButton_Click">
                                                <Button.Content>
                                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                                        <FontIcon Glyph="&#xE74C;" FontSize="14"/>
                                                        <TextBlock Text="安装到游戏"/>
                                                    </StackPanel>
                                                </Button.Content>
                                            </Button>

                                            <!-- 已安装状态 -->
                                            <StackPanel
                                                Orientation="Horizontal"
                                                Spacing="6"
                                                Visibility="{x:Bind IsInstalledStatusVisible}">
                                                <FontIcon
                                                    Glyph="&#xE73E;"
                                                    FontSize="16"
                                                    Foreground="{ThemeResource SystemFillColorSuccessBrush}"/>
                                                <TextBlock
                                                    Text="已安装"
                                                    FontSize="14"
                                                    Foreground="{ThemeResource SystemFillColorSuccessBrush}"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="Padding" Value="0"/>
                                </Style>
                            </ListView.ItemContainerStyle>
                        </ListView>

                        <!-- 空状态提示 -->
                        <StackPanel
                            x:Name="EmptyFontsPanel"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="12"
                            Visibility="Collapsed">
                            <FontIcon
                                Glyph="&#xE8D2;"
                                FontSize="48"
                                Opacity="0.3"/>
                            <TextBlock
                                Text="未找到可用字体"
                                FontSize="16"
                                Opacity="0.6"/>
                            <Button
                                Content="点击刷新"
                                Style="{StaticResource AccentButtonStyle}"
                                Click="RefreshButton_Click"/>
                        </StackPanel>

                        <!-- 加载中提示 -->
                        <StackPanel
                            x:Name="LoadingPanel"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="12"
                            Visibility="Visible">
                            <ProgressRing
                                IsActive="True"
                                Width="48"
                                Height="48"/>
                            <TextBlock
                                Text="加载字体列表中..."
                                FontSize="14"
                                Opacity="0.7"/>
                        </StackPanel>

                        <!-- 错误提示 -->
                        <StackPanel
                            x:Name="ErrorPanel"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="12"
                            Visibility="Collapsed">
                            <FontIcon
                                Glyph="&#xE7BA;"
                                FontSize="48"
                                Opacity="0.3"
                                Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>
                            <TextBlock
                                x:Name="ErrorTextBlock"
                                Text="加载失败"
                                FontSize="16"
                                Opacity="0.6"
                                TextAlignment="Center"
                                TextWrapping="Wrap"
                                MaxWidth="400"/>
                            <Button
                                Content="重试"
                                Style="{StaticResource AccentButtonStyle}"
                                Click="RefreshButton_Click"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </StackPanel>

            <!-- 使用说明区域 -->
            <StackPanel Spacing="16">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon
                        Glyph="&#xE946;"
                        FontSize="24"
                        VerticalAlignment="Center"
                        Foreground="{ThemeResource SystemAccentColor}"/>
                    <TextBlock
                        Text="使用说明"
                        FontSize="22"
                        FontWeight="SemiBold"
                        VerticalAlignment="Center"/>
                </StackPanel>

                <Border
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="20">
                    <StackPanel Spacing="12">
                        <TextBlock TextWrapping="Wrap" FontSize="14">
                            <Run FontWeight="SemiBold">1. 选择字体：</Run>
                            <LineBreak/>
                            <Run>推荐选择与游戏 Unity 版本最接近的字体。版本越接近，兼容性越好。</Run>
                        </TextBlock>

                        <TextBlock TextWrapping="Wrap" FontSize="14">
                            <Run FontWeight="SemiBold">2. 下载字体：</Run>
                            <LineBreak/>
                            <Run>点击"下载"按钮将字体下载到本地缓存。下载后可在任何游戏中重复使用。</Run>
                        </TextBlock>

                        <TextBlock TextWrapping="Wrap" FontSize="14">
                            <Run FontWeight="SemiBold">3. 安装字体：</Run>
                            <LineBreak/>
                            <Run>点击"安装到游戏"按钮将字体复制到游戏的 BepInEx\fonts 目录。</Run>
                        </TextBlock>

                        <TextBlock TextWrapping="Wrap" FontSize="14">
                            <Run FontWeight="SemiBold">4. 配置字体：</Run>
                            <LineBreak/>
                            <Run>前往"配置编辑"页面，在"TextMeshPro 字体覆盖"或"TextMeshPro 备用字体"中填入字体路径（例如: BepInEx\fonts\SourceHanSans_U2018-4-36）。</Run>
                        </TextBlock>

                        <Border
                            Background="{ThemeResource AccentFillColorDefaultBrush}"
                            BorderThickness="0"
                            CornerRadius="4"
                            Padding="12"
                            Opacity="0.1"/>
                        <TextBlock TextWrapping="Wrap" FontSize="13" Opacity="0.8">
                            <Run FontWeight="SemiBold" Text="提示："/>
                            <Run Text="字体文件名称格式为【字体名_U版本号】，例如 SourceHanSans_U2018-4-36 表示使用 SourceHanSans 字体创建，适用于 Unity 2018.4.36 版本。"/>
                        </TextBlock>
                    </StackPanel>
                </Border>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</Page>
