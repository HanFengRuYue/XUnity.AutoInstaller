<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="XUnity_AutoInstaller.Pages.InstallPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:XUnity_AutoInstaller.Pages"
    xmlns:viewmodels="using:XUnity_AutoInstaller.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <ScrollViewer>
        <StackPanel Spacing="24" Margin="24">
            <!-- 页面标题 -->
            <TextBlock
                Text="安装配置"
                Style="{StaticResource TitleTextBlockStyle}"/>

            <!-- 版本选择区 -->
            <StackPanel Spacing="16">
                <TextBlock
                    Text="版本选择"
                    Style="{StaticResource SubtitleTextBlockStyle}"/>

                <Border
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="20">
                    <StackPanel Spacing="16">
                        <!-- 版本选择模式 -->
                        <RadioButtons x:Name="VersionModeRadio" SelectedIndex="{x:Bind ViewModel.VersionModeIndex, Mode=TwoWay}">
                            <RadioButton Content="自动推荐版本（推荐）" IsChecked="True"/>
                            <RadioButton Content="手动选择版本"/>
                        </RadioButtons>

                        <!-- BepInEx 版本选择 -->
                        <StackPanel Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="BepInEx 版本" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                <ProgressRing
                                    x:Name="BepInExVersionLoadingRing"
                                    Width="16"
                                    Height="16"
                                    IsActive="{x:Bind ViewModel.IsBepInExLoading, Mode=OneWay}"
                                    Visibility="{x:Bind ViewModel.BepInExLoadingVisibility, Mode=OneWay}"/>
                            </StackPanel>
                            <ComboBox
                                x:Name="BepInExVersionComboBox"
                                HorizontalAlignment="Stretch"
                                PlaceholderText="{x:Bind ViewModel.BepInExPlaceholder, Mode=OneWay}"
                                ItemsSource="{x:Bind ViewModel.BepInExItems, Mode=OneWay}"
                                SelectedItem="{x:Bind ViewModel.SelectedBepInExItem, Mode=TwoWay}"
                                DisplayMemberPath="Display"
                                IsEnabled="{x:Bind ViewModel.AreVersionComboBoxesEnabled, Mode=OneWay}"/>
                        </StackPanel>

                        <!-- XUnity 版本选择 -->
                        <StackPanel Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="XUnity.AutoTranslator 版本" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                <ProgressRing
                                    x:Name="XUnityVersionLoadingRing"
                                    Width="16"
                                    Height="16"
                                    IsActive="{x:Bind ViewModel.IsXUnityLoading, Mode=OneWay}"
                                    Visibility="{x:Bind ViewModel.XUnityLoadingVisibility, Mode=OneWay}"/>
                            </StackPanel>
                            <ComboBox
                                x:Name="XUnityVersionComboBox"
                                HorizontalAlignment="Stretch"
                                PlaceholderText="{x:Bind ViewModel.XUnityPlaceholder, Mode=OneWay}"
                                ItemsSource="{x:Bind ViewModel.XUnityItems, Mode=OneWay}"
                                SelectedItem="{x:Bind ViewModel.SelectedXUnityItem, Mode=TwoWay}"
                                DisplayMemberPath="Display"
                                IsEnabled="{x:Bind ViewModel.AreVersionComboBoxesEnabled, Mode=OneWay}"/>
                        </StackPanel>

                        <!-- 平台选择 -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="目标平台" FontWeight="SemiBold"/>
                            <ComboBox
                                x:Name="PlatformComboBox"
                                HorizontalAlignment="Stretch"
                                SelectedIndex="{x:Bind ViewModel.SelectedPlatformIndex, Mode=TwoWay}"
                                IsEnabled="{x:Bind ViewModel.IsPlatformComboBoxEnabled, Mode=OneWay}">
                                <ComboBoxItem Content="BepInEx x64"/>
                                <ComboBoxItem Content="BepInEx x86"/>
                                <ComboBoxItem Content="BepInEx IL2CPP x64"/>
                                <ComboBoxItem Content="BepInEx IL2CPP x86"/>
                            </ComboBox>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- 安装选项 -->
            <StackPanel Spacing="16">
                <TextBlock
                    Text="安装选项"
                    Style="{StaticResource SubtitleTextBlockStyle}"/>

                <Border
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="20">
                    <StackPanel Spacing="12">
                        <CheckBox
                            x:Name="BackupCheckBox"
                            Content="安装前备份现有文件"
                            IsChecked="{x:Bind ViewModel.BackupExisting, Mode=TwoWay}"/>
                        <CheckBox
                            x:Name="CleanInstallCheckBox"
                            Content="清理旧版本后安装"
                            IsChecked="{x:Bind ViewModel.CleanOldVersion, Mode=TwoWay}"/>
                        <CheckBox
                            x:Name="LaunchGameCheckBox"
                            Content="安装后启动游戏生成配置文件（推荐）"
                            IsChecked="{x:Bind ViewModel.LaunchGameToGenerateConfig, Mode=TwoWay}">
                            <ToolTipService.ToolTip>
                                <ToolTip Content="BepInEx首次运行需要启动游戏才能生成配置文件，建议启用此选项自动完成"/>
                            </ToolTipService.ToolTip>
                        </CheckBox>

                        <!-- 配置生成高级选项 -->
                        <Expander
                            x:Name="ConfigGenerationExpander"
                            Header="高级选项"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Stretch"
                            IsExpanded="False">
                            <StackPanel Spacing="12" Margin="0,8,0,0" HorizontalAlignment="Stretch">
                                <StackPanel Spacing="8">
                                    <TextBlock Text="配置生成超时时间（秒）" FontSize="12"/>
                                    <NumberBox
                                        x:Name="ConfigTimeoutNumberBox"
                                        Value="{x:Bind ViewModel.ConfigGenerationTimeout, Mode=TwoWay}"
                                        Minimum="10"
                                        Maximum="300"
                                        SpinButtonPlacementMode="Inline"
                                        HorizontalAlignment="Stretch"/>
                                    <TextBlock
                                        Text="如果游戏启动较慢，可适当增加超时时间"
                                        FontSize="11"
                                        Opacity="0.7"
                                        TextWrapping="Wrap"/>
                                </StackPanel>
                            </StackPanel>
                        </Expander>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- 安装操作区 -->
            <StackPanel Spacing="16">
                <Button
                    x:Name="StartInstallButton"
                    HorizontalAlignment="Stretch"
                    Style="{StaticResource AccentButtonStyle}"
                    Padding="16,12"
                    Click="StartInstallButton_Click">
                    <Button.Content>
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE896;" FontSize="20"/>
                            <TextBlock Text="开始安装" FontSize="16" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button.Content>
                </Button>

                <!-- 进度显示 -->
                <StackPanel x:Name="ProgressPanel" Spacing="12" Visibility="{x:Bind ViewModel.ProgressPanelVisibility, Mode=OneWay}">
                    <ProgressBar
                        x:Name="InstallProgressBar"
                        Maximum="100"
                        Value="{x:Bind ViewModel.InstallProgress, Mode=OneWay}"
                        Height="6"/>

                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <ProgressRing
                            x:Name="InstallProgressRing"
                            IsActive="{x:Bind ViewModel.IsInstalling, Mode=OneWay}"
                            Width="20"
                            Height="20"/>
                        <TextBlock
                            x:Name="ProgressText"
                            Text="{x:Bind ViewModel.InstallStatusMessage, Mode=OneWay}"
                            VerticalAlignment="Center"/>
                        <TextBlock
                            x:Name="ProgressPercentText"
                            Text="{x:Bind ViewModel.ProgressPercentText, Mode=OneWay}"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource SystemAccentColor}"/>
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</Page>
